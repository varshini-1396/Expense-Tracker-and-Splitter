<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneyMate - Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css', v=1) }}">
</head>
<body>
    <nav class="navbar">
        <div class="logo">MoneyMate</div>
        <div class="nav-links">
            <a href="{{ url_for('stats') }}">Stats</a>
            <a href="{{ url_for('transactions') }}">Transactions</a>
            <a href="{{ url_for('splitter') }}">Splitter</a>
            <a href="{{ url_for('groups_page') }}">Groups</a>
            <a href="{{ url_for('profile_page') }}">Profile</a>
        </div>
    </nav>

    <main>
        <div class="greeting">
            <h1>Welcome to <span class="purple">MoneyMate</span></h1>
        </div>

        <div class="dashboard">
            <div class="balance-card">
                <h2>Total Balance</h2>
                <div class="amount" id="total-balance">₹0.00</div>
                <div class="transactions">
                    <div class="incoming">
                        <span class="arrow up">↑</span>
                        <span>Incoming</span>
                        <div class="amount" id="total-incoming">₹0.00</div>
                    </div>
                    <div class="outgoing">
                        <span class="arrow down">↓</span>
                        <span>Outgoing</span>
                        <div class="amount" id="total-outgoing">₹0.00</div>
                    </div>
                </div>
            </div>

            <!-- Transactions List -->
            <div class="transactions-list">
                <h3>Recent Transactions</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Type</th>
                        </tr>
                    </thead>
                    <tbody id="transactions-table">
                        <!-- Transactions will be added here dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Transaction Modal -->
    <div id="transaction-modal" class="modal">
        <div class="modal-content">
            <h2>Add Transaction</h2>
            <form id="transaction-form" onsubmit="addTransaction(event)">
                <div class="form-group">
                    <label for="amount">Amount</label>
                    <input type="number" id="amount" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label for="description">Description</label>
                    <input type="text" id="description" required>
                </div>
                <div class="form-group">
                    <label for="category">Category</label>
                    <select id="category" required>
                        <option value="">Select a category</option>
                        <option value="Food">Food</option>
                        <option value="Transport">Transport</option>
                        <option value="Rent">Rent</option>
                        <option value="Utilities">Utilities</option>
                        <option value="Shopping">Shopping</option>
                        <option value="Entertainment">Entertainment</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <input type="hidden" id="transaction-type">
                <div class="modal-buttons">
                    <button type="button" onclick="closeTransactionModal()">Cancel</button>
                    <button type="submit">Add</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Transaction Modal -->
    <div id="edit-transaction-modal" class="modal">
        <div class="modal-content">
            <h2>Edit Transaction</h2>
            <form id="edit-transaction-form" onsubmit="updateTransaction(event)">
                <div class="form-group">
                    <label for="edit-amount">Amount</label>
                    <input type="number" id="edit-amount" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label for="edit-description">Description</label>
                    <input type="text" id="edit-description" required>
                </div>
                <div class="form-group">
                    <label for="edit-category">Category</label>
                    <select id="edit-category" required>
                        <option value="">Select a category</option>
                        <option value="Food">Food</option>
                        <option value="Transport">Transport</option>
                        <option value="Rent">Rent</option>
                        <option value="Utilities">Utilities</option>
                        <option value="Shopping">Shopping</option>
                        <option value="Entertainment">Entertainment</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <input type="hidden" id="edit-transaction-id">
                <input type="hidden" id="edit-transaction-type">
                <div class="modal-buttons">
                    <button type="button" onclick="deleteTransaction()">Delete</button>
                    <button type="button" onclick="closeEditTransactionModal()">Cancel</button>
                    <button type="submit">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Load transactions on page load
        document.addEventListener('DOMContentLoaded', loadTransactions);

        function loadTransactions() {
            // First get the stats for balances
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    updateBalances(data);
                    // Update transactions list with recent transactions from stats
                    if (data.recent_transactions && data.recent_transactions.length > 0) {
                        updateTransactionsList(data.recent_transactions);
                    } else {
                        // If no recent transactions in stats, try to get from transactions API
                        fetch('/api/transactions')
                            .then(response => response.json())
                            .then(transactions => {
                                // Sort transactions by date (newest first)
                                const sortedTransactions = transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
                                // Take only the 5 most recent transactions
                                const recentTransactions = sortedTransactions.slice(0, 5);
                                updateTransactionsList(recentTransactions);
                            })
                            .catch(error => console.error('Error loading transactions:', error));
                    }
                })
                .catch(error => console.error('Error loading stats:', error));
        }

        function updateTransactionsList(transactions) {
            const tbody = document.getElementById('transactions-table');
            tbody.innerHTML = '';
            
            if (!transactions || transactions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No transactions found</td></tr>';
                return;
            }

            transactions.forEach(t => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(t.date).toLocaleDateString()}</td>
                    <td>${t.description || 'No description'}</td>
                    <td class="${t.type}">${t.type === 'incoming' ? '+' : '-'}₹${parseFloat(t.amount).toFixed(2)}</td>
                    <td>${t.type}${t.is_group ? ' (Group)' : ''}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateBalances(data) {
            const totalBalance = data.total_balance || 0;
            const totalIncoming = data.total_incoming || 0;
            const totalOutgoing = data.total_outgoing || 0;

            document.getElementById('total-balance').textContent = `₹${totalBalance.toFixed(2)}`;
            document.getElementById('total-incoming').textContent = `+₹${totalIncoming.toFixed(2)}`;
            document.getElementById('total-outgoing').textContent = `-₹${totalOutgoing.toFixed(2)}`;
        }

        function showTransactionModal(type) {
            document.getElementById('transaction-modal').style.display = 'flex';
            document.getElementById('transaction-type').value = type;
        }

        function closeTransactionModal() {
            document.getElementById('transaction-modal').style.display = 'none';
            document.getElementById('transaction-form').reset();
        }

        function addTransaction(event) {
            event.preventDefault();
            
            const amount = document.getElementById('amount').value;
            const description = document.getElementById('description').value;
            const category = document.getElementById('category').value;
            const type = document.getElementById('transaction-type').value;

            fetch('/api/transactions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    amount: parseFloat(amount),
                    description: description,
                    category: category,
                    type: type
                })
            })
            .then(response => response.json())
            .then(() => {
                closeTransactionModal();
                loadTransactions();
            });
        }

        function showEditTransactionModal(id, amount, description, category, type) {
            document.getElementById('edit-transaction-id').value = id;
            document.getElementById('edit-amount').value = amount;
            document.getElementById('edit-description').value = description;
            document.getElementById('edit-category').value = category;
            document.getElementById('edit-transaction-type').value = type;
            document.getElementById('edit-transaction-modal').style.display = 'flex';
        }

        function closeEditTransactionModal() {
            document.getElementById('edit-transaction-modal').style.display = 'none';
            document.getElementById('edit-transaction-form').reset();
        }

        function updateTransaction(event) {
            event.preventDefault();
            
            const id = document.getElementById('edit-transaction-id').value;
            const amount = document.getElementById('edit-amount').value;
            const description = document.getElementById('edit-description').value;
            const category = document.getElementById('edit-category').value;
            const type = document.getElementById('edit-transaction-type').value;

            fetch(`/api/transactions/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    amount: parseFloat(amount),
                    description: description,
                    category: category,
                    type: type
                })
            })
            .then(response => response.json())
            .then(() => {
                closeEditTransactionModal();
                loadTransactions();
            });
        }

        function deleteTransaction() {
            if (!confirm('Are you sure you want to delete this transaction?')) {
                return;
            }

            const id = document.getElementById('edit-transaction-id').value;

            fetch(`/api/transactions/${id}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(() => {
                closeEditTransactionModal();
                loadTransactions();
            });
        }
    </script>
</body>
</html> 
 